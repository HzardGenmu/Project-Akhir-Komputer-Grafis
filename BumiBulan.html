<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tata Surya Three.js (Fixed)</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: black; 
            font-family: sans-serif;
            color: white;
        }
        canvas { display: block; }
        #controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.6);
            padding: 12px 14px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            user-select: none;
            backdrop-filter: blur(5px);
            max-width: 220px;
        }
        #controls h3 {
            margin: 0 0 4px 0;
            font-size: 1rem;
        }
        #controls label { font-size: 0.9em; margin-bottom: 5px; display: block; }
        #controls input[type="range"] { width: 160px; cursor: pointer; }
        .note { font-size: 0.75em; color: #aaa; margin-top: 5px; line-height: 1.3; }
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>
    <div id="controls">
        <h3>Kontrol Tata Surya</h3>
        <div>
            <label for="revolutionSpeed">Kecepatan Revolusi (Orbit)</label>
            <input type="range" id="revolutionSpeed" min="0" max="5" value="1" step="0.1">
        </div>
        <div>
            <label for="rotationSpeed">Kecepatan Rotasi Planet</label>
            <input type="range" id="rotationSpeed" min="0" max="5" value="1" step="0.1">
        </div>
        <div class="note">*Skala ukuran dan jarak tidak 100% akurat agar semua planet bisa terlihat dalam satu layar.</div>
    </div>
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // --- SETUP SCENE ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document.body.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        
        camera.position.set(0, 60, 100);
        controls.update();

        // Slider untuk mengatur kecepatan
        const revolutionSpeedInput = document.getElementById('revolutionSpeed');
        const rotationSpeedInput = document.getElementById('rotationSpeed');

        // --- OBJEK ---
        // Texture Loader
        const textureLoader = new THREE.TextureLoader();

        //JANGAN DIUBAH
        // Matahari (dengan tekstur dari folder texture)
        const sunGeo = new THREE.SphereGeometry(5, 32, 32);
        const sunTexture = textureLoader.load('./texture/matahari.png');
        const sunMat = new THREE.MeshBasicMaterial({ map: sunTexture });
        const sun = new THREE.Mesh(sunGeo, sunMat);
        scene.add(sun);

        // Cahaya (Pusat di matahari)
        const light = new THREE.PointLight(0xffffff, 1000, 0);
        light.castShadow = true;
        light.shadow.mapSize.width = 2048;
        light.shadow.mapSize.height = 2048;
        light.shadow.bias = -0.0001;
        sun.add(light);
        // Tambahkan cahaya ambient agar sisi gelap tidak hitam pekat
        const ambientLight = new THREE.AmbientLight(0x404040); 
        scene.add(ambientLight);

         //JANGAN DIUBAH
        // Bumi (dengan tekstur dari URL)
        const earthGeo = new THREE.SphereGeometry(2, 32, 32);
        const earthTexture = textureLoader.load('./texture/bumi.jpg');
        const earthMat = new THREE.MeshStandardMaterial({ map: earthTexture });
        const earth = new THREE.Mesh(earthGeo, earthMat);
        earth.castShadow = true;
        earth.receiveShadow = true;
        scene.add(earth);

         //JANGAN DIUBAH
        // Bulan (dengan tekstur dari folder texture)
        const moonGeo = new THREE.SphereGeometry(0.5, 32, 32);
        const moonTexture = textureLoader.load('./texture/bulan.jpg');
        const moonMat = new THREE.MeshStandardMaterial({ map: moonTexture });
        const moon = new THREE.Mesh(moonGeo, moonMat);
        moon.castShadow = true;
        moon.receiveShadow = true;
        earth.add(moon); // Anak dari Bumi
        moon.position.x = 4; // Jarak bulan dari bumi

        // Bintang (Background)
        const starGeo = new THREE.BufferGeometry();
        const starCount = 1000;
        const posArray = new Float32Array(starCount * 3);
        for(let i = 0; i < starCount * 3; i++) {
            posArray[i] = (Math.random() - 0.5) * 200;
        }
        starGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const starMat = new THREE.PointsMaterial({size: 0.1, color: 0xffffff});
        const stars = new THREE.Points(starGeo, starMat);
        scene.add(stars);


        // Data Planet (Bumi dihapus dari list ini karena sudah ada di atas)
        const planetData = [
            { name: "Mercury", texture: './texture/mercury.jpg', size: 0.8, distance: 10, speed: 4.7 },
            { name: "Venus",   texture: './texture/venus.jpg',   size: 1.5, distance: 15, speed: 3.5 },
            { name: "Mars",    texture: './texture/mars.jpg',    size: 0.9, distance: 30, speed: 2.4 },
            { name: "Jupiter", texture: './texture/jupiter.jpg', size: 4.0, distance: 45, speed: 1.3 },
            { name: "Saturn",  texture: './texture/saturn.jpg',  size: 3.5, distance: 65, speed: 0.9, hasRing: true },
            { name: "Uranus",  texture: './texture/uranus.jpg',  size: 2.5, distance: 85, speed: 0.6 },
            { name: "Neptune", texture: './texture/neptune.jpg', size: 2.4, distance: 100, speed: 0.5 }
        ];

        const otherPlanets = [];

        planetData.forEach((data) => {

            const planetTexture = textureLoader.load(data.texture);

            // Buat Mesh Planet dengan Texture
            const geometry = new THREE.SphereGeometry(data.size, 32, 32);
            const material = new THREE.MeshStandardMaterial({ 
                map: planetTexture,
                roughness: 0.7,
                metalness: 0.1
            });
            const planet = new THREE.Mesh(geometry, material);
            planet.castShadow = true;
            planet.receiveShadow = true;
            
            // Buat Garis Orbit (Visualisasi jalur)
            const orbitGeo = new THREE.RingGeometry(data.distance - 0.1, data.distance + 0.1, 64);
            const orbitMat = new THREE.MeshBasicMaterial({ 
                color: 0xffffff, 
                side: THREE.DoubleSide, 
                opacity: 0.15, 
                transparent: true 
            });
            const orbit = new THREE.Mesh(orbitGeo, orbitMat);
            orbit.rotation.x = -Math.PI / 2;
            scene.add(orbit);

            // Khusus Saturnus: Tambah Cincin 
            if (data.hasRing) {
                const ringGeo = new THREE.RingGeometry(data.size + 1, data.size + 3.5, 64);
                const ringMat = new THREE.MeshStandardMaterial({ 
                    color: 0xAA8866, 
                    side: THREE.DoubleSide,
                    transparent: true,
                    opacity: 0.8
                });
                const ring = new THREE.Mesh(ringGeo, ringMat);
                ring.rotation.x = -Math.PI / 2;
                ring.rotation.y = -Math.PI / 12;
                ring.castShadow = true;
                ring.receiveShadow = true;
                planet.add(ring);
            }

            scene.add(planet);

            // Posisi awal acak
            const initialAngle = Math.random() * Math.PI * 2; 
            planet.position.x = Math.cos(initialAngle) * data.distance;
            planet.position.z = Math.sin(initialAngle) * data.distance;

            // Simpan data
            planet.orbitDistance = data.distance;
            planet.orbitSpeed = data.speed;
            planet.angleOffset = initialAngle;

            otherPlanets.push(planet);
        });

        // --- ANIMASI ---
        function animate() {
            requestAnimationFrame(animate);
            
            const time = Date.now() * 0.001; // Waktu dalam detik
            const revMultiplier = parseFloat(revolutionSpeedInput.value);
            const rotMultiplier = parseFloat(rotationSpeedInput.value);

            // Rotasi Matahari
            sun.rotation.y += 0.005 * rotMultiplier;

            // Orbit Bumi
            const earthAngle = time * revMultiplier;
            earth.position.x = Math.cos(earthAngle) * 20;
            earth.position.z = Math.sin(earthAngle) * 20;
            earth.rotation.y += 0.02 * rotMultiplier;

            controls.update();
            renderer.render(scene, camera);

            // Animasi Planet Tambahan
            otherPlanets.forEach(planet => {
                const speedFactor = 0.2;
                const angle = (time * planet.orbitSpeed * speedFactor * revMultiplier) + planet.angleOffset;
                
                planet.position.x = Math.cos(angle) * planet.orbitDistance;
                planet.position.z = Math.sin(angle) * planet.orbitDistance;
                
                // Rotasi planet pada porosnya
                planet.rotation.y += 0.01 * rotMultiplier;
            });
        }

        animate();

        // --- RESIZE WINDOW ---
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
